<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mascot Integrations Catalog</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    margin: 20px; 
    background: #f9f9f9; 
  }

  header {
    display: flex;
    align-items: center; /* vertically centers logo and text */
    margin-bottom: 20px;
  }

  header img {
    height: 60px;
    margin-right: 15px; /* spacing like contact.html */
    flex-shrink: 0;
  }

  h1 {
    margin: 0; /* remove default margin */
  }

  #searchInput { 
    width: 100%; 
    padding: 8px; 
    margin: 20px 0; 
    font-size: 1em; 
    border-radius: 6px; 
    border: 1px solid #ccc; 
  }

  #catalog {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  details { 
    margin-bottom: 15px; 
    border: 1px solid #ddd; 
    border-radius: 6px; 
    padding: 10px; 
    background: #fff; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
  }

  summary { 
    font-weight: bold; 
    cursor: pointer; 
  }

  .format { 
    margin-left: 20px; 
    margin-top: 8px; 
  }

  a { 
    color: #007bff; 
    text-decoration: none; 
  }

  a:hover { 
    text-decoration: underline; 
  }

  .badge { 
    display: inline-block; 
    padding: 3px 8px; 
    margin-right: 5px; 
    border-radius: 12px; 
    font-size: 0.85em; 
    color: #fff; 
  }

  .SFTP { background-color: #ff6b6b; }
  .FTP { background-color: #ffa94d; }
  .HTTP { background-color: #339af0; }
  .EMAIL { background-color: #51cf66; }

  #requestButton { 
    display: inline-block; 
    margin-top: 30px; 
    padding: 12px 20px; 
    background: #339af0; 
    color: #fff; 
    border-radius: 6px; 
    text-decoration: none; 
    font-size: 1em; 
  }

  #requestButton:hover { 
    background: #1c7ed6; 
  }

  .notes { 
    font-style: italic; 
    color: #555; 
    margin-left: 5px; 
  }
</style>
</head>
<body>

<header>
  <img src="images/mascot-logo.png" alt="Mascot Logo">
  <h1>Mascot Integrations Catalog</h1>
</header>

<input type="text" id="searchInput" placeholder="Search categories or formats...">
<div id="catalog"></div>
<a id="requestButton" href="contact.html">Request Integration</a>

<script>
let catalogData = {};

// Load catalog.json
fetch('catalog.json')
  .then(res => res.json())
  .then(data => {
    catalogData = data;
    renderCatalog(data.categories);
  });

// Render collapsible catalog
function renderCatalog(categories) {
  const container = document.getElementById('catalog');
  container.innerHTML = '';

  categories.forEach(cat => {
    const details = document.createElement('details');
    const summary = document.createElement('summary');
    summary.textContent = cat.name;
    details.appendChild(summary);

    cat.formats.forEach(f => {
      const fmtDiv = document.createElement('div');
      fmtDiv.className = 'format';

      let html = `<strong>${f.name}</strong> - <a href="${f.docUrl}" target="_blank">View Documentation</a>`;
      if (f.notes) html += ` <span class="notes">(${f.notes})</span>`;

      f.connections.forEach(conn => {
        html += ` <span class="badge ${conn}">${conn}</span>`;
      });

      fmtDiv.innerHTML = html;
      details.appendChild(fmtDiv);
    });

    container.appendChild(details);
  });
}

// Search functionality with automatic expand
document.getElementById('searchInput').addEventListener('input', (e) => {
  const term = e.target.value.toLowerCase();
  const filtered = catalogData.categories.map(cat => {
    const matchedFormats = cat.formats.filter(f =>
      f.name.toLowerCase().includes(term) ||
      (f.notes && f.notes.toLowerCase().includes(term)) ||
      cat.name.toLowerCase().includes(term)
    );
    return matchedFormats.length ? { ...cat, formats: matchedFormats } : null;
  }).filter(Boolean);

  renderCatalog(filtered);

  // Automatically expand matching categories
  document.querySelectorAll('#catalog details').forEach(details => {
    const summaryText = details.querySelector('summary').textContent.toLowerCase();
    const hasMatch = summaryText.includes(term) || [...details.querySelectorAll('.format')].some(f => f.textContent.toLowerCase().includes(term));
    details.open = hasMatch;
  });
});
</script>

</body>
</html>
