<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mascot Integration Catalog</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
  header { display: flex; align-items: center; margin-bottom: 20px; }
  header img { height: 50px; margin-right: 15px; }
  h1 { margin: 0; }
  .filter, .form-section { margin-bottom: 20px; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
  .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; color: white; margin: 2px; font-size: 0.85em;}
  .HTTP { background: #007bff; }
  .SFTP { background: #28a745; }
  .FTP { background: #ffc107; color: #000; }
  .EMAIL { background: #dc3545; }
  select, input, button { padding: 5px; margin: 5px 0; width: 100%; max-width: 400px; }
  button { cursor: pointer; background: #007bff; color: #fff; border: none; border-radius: 4px; }
  .catalog-item { margin-bottom: 10px; padding: 10px; border-bottom: 1px solid #ddd; }
</style>
</head>
<body>

<header>
  <img src="mascot_logo.png" alt="Mascot Logo">
  <h1>Mascot Integration Catalog</h1>
</header>

<div class="filter">
  <h2>Filter Integrations</h2>
  <label>Category:</label>
  <select id="categoryFilter">
    <option value="">All</option>
  </select>
  <label>Format:</label>
  <select id="formatFilter">
    <option value="">All</option>
  </select>
  <label>Connection:</label>
  <select id="connectionFilter">
    <option value="">All</option>
    <option value="HTTP">HTTP</option>
    <option value="SFTP">SFTP</option>
    <option value="FTP">FTP</option>
    <option value="EMAIL">EMAIL</option>
  </select>
</div>

<div id="catalog"></div>

<div class="form-section">
  <h2>Request Integration</h2>
  <form id="integrationForm">
    <label>Company Name:</label>
    <input type="text" name="company" required>
    
    <label>Existing or New Mascot Customer?</label>
    <select name="customerType" required>
      <option value="">Select</option>
      <option value="Existing">Existing</option>
      <option value="New">New</option>
    </select>

    <label>Integration Type:</label>
    <select id="integrationType" name="integrationType" required>
      <option value="">Select</option>
    </select>

    <label>Format(s):</label>
    <select id="integrationFormat" name="integrationFormat" multiple required></select>

    <label>Connection(s):</label>
    <select id="integrationConnection" name="integrationConnection" multiple required></select>

    <label>Technical Contact (Name + Email):</label>
    <input type="text" name="contact" placeholder="Name + Email" required>

    <label>Proposed Go-Live Date:</label>
    <input type="date" name="goLiveDate" required>

    <button type="submit">Submit Request</button>
  </form>
</div>

<script>
// Load catalog.json
let catalog = null;

fetch('catalog.json')
  .then(res => res.json())
  .then(data => {
    catalog = data.categories;
    populateFilters();
    populateIntegrationForm();
    displayCatalog();
  });

function populateFilters() {
  const catSelect = document.getElementById('categoryFilter');
  catalog.forEach(cat => {
    let opt = document.createElement('option');
    opt.value = cat.name;
    opt.textContent = cat.name;
    catSelect.appendChild(opt);
  });
}

function populateIntegrationForm() {
  const typeSelect = document.getElementById('integrationType');
  catalog.forEach(cat => {
    let opt = document.createElement('option');
    opt.value = cat.name;
    opt.textContent = cat.name;
    typeSelect.appendChild(opt);
  });
}

function displayCatalog() {
  const container = document.getElementById('catalog');
  container.innerHTML = '';
  const catVal = document.getElementById('categoryFilter').value;
  const fmtVal = document.getElementById('formatFilter').value;
  const connVal = document.getElementById('connectionFilter').value;

  catalog.forEach(cat => {
    if(catVal && cat.name !== catVal) return;
    cat.formats.forEach(fmt => {
      if(fmtVal && fmt.name !== fmtVal) return;
      if(connVal && !fmt.connections.includes(connVal)) return;

      let html = `<div class="catalog-item"><strong>${fmt.name}</strong> - <a href="${fmt.docUrl}" target="_blank">LINK</a><br>`;
      fmt.connections.forEach(c => html += `<span class="badge ${c}">${c}</span>`);
      html += '</div>';
      container.innerHTML += html;
    });
  });
}

// Filter events
document.getElementById('categoryFilter').addEventListener('change', displayCatalog);
document.getElementById('formatFilter').addEventListener('change', displayCatalog);
document.getElementById('connectionFilter').addEventListener('change', displayCatalog);

// Smart multi-select logic
const typeSelect = document.getElementById('integrationType');
const formatSelect = document.getElementById('integrationFormat');
const connectionSelect = document.getElementById('integrationConnection');

typeSelect.addEventListener('change', updateFormats);
formatSelect.addEventListener('change', updateConnections);

function updateFormats() {
  const type = typeSelect.value;
  formatSelect.innerHTML = '';
  connectionSelect.innerHTML = '';
  if(!type) return;
  const category = catalog.find(c => c.name === type);
  category.formats.forEach(f => {
    const opt = document.createElement('option');
    opt.value = f.name;
    opt.textContent = f.name;
    formatSelect.appendChild(opt);
  });
}

function updateConnections() {
  const type = typeSelect.value;
  const selectedFormats = Array.from(formatSelect.selectedOptions).map(o => o.value);
  connectionSelect.innerHTML = '';
  if(!type || selectedFormats.length === 0) return;
  const category = catalog.find(c => c.name === type);

  // Determine available connections: intersection of selected formats
  let available = null;
  selectedFormats.forEach(fName => {
    const fmt = category.formats.find(f => f.name === fName);
    if(!available) available = [...fmt.connections];
    else available = available.filter(c => fmt.connections.includes(c));
  });

  available.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    connectionSelect.appendChild(opt);
  });
}

// Lobster form submission
document.getElementById('integrationForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const formData = new FormData(e.target);
  const payload = {};
  formData.forEach((v,k) => { payload[k] = v; });

  // Here you would send payload to Lobster API to create Jira ticket
  fetch('https://your-lobster-endpoint.com/api', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => alert('Integration request submitted!'))
  .catch(err => alert('Error submitting request'));
});
</script>

</body>
</html>
